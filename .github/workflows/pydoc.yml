name: Pydoc

on: [push]

permissions:
    pages: write
    id-token: write
    contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.12"]
    steps:
    - uses: actions/checkout@v4
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
         - name: Make repository importable
        run: |
          echo "PYTHONPATH=$(pwd)" >> $GITHUB_ENV

         - name: Make repository importable
        run: |
          echo "PYTHONPATH=$(pwd)" >> $GITHUB_ENV

    - name: Generate pydoc for all Python files
    run: |
          mkdir -p docs
          for f in *.py; do
            python -m pydoc -w "$f"
            mv "${f%.py}.html" docs/
          done
    - name: Create index.html
    run: |
          echo "<html><body><h1>Project Documentation</h1><ul>" > docs/index.html
          for f in docs/*.html; do
            fname=$(basename "$f")
            echo "<li><a href=\"$fname\">$fname</a></li>" >> docs/index.html
          done
          echo "</ul></body></html>" >> docs/index.html

- name: Upload docs artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs
